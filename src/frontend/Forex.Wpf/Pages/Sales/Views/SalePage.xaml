<Page
    x:Class="Forex.Wpf.Pages.Sales.SalePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Forex.Wpf.Resources.UserControls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Forex.Wpf.Pages.Sales.ViewModels"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    x:Name="RootPage"
    Title="SalePage"
    d:DesignHeight="650"
    d:DesignWidth="1100"
    Background="{DynamicResource PrimaryBackground}"
    mc:Ignorable="d">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <DockPanel Grid.Row="0" LastChildFill="False">
            <Label
                Content="🛒 Savdolar ro'yxati"
                FontSize="18"
                FontWeight="Bold"
                Foreground="{StaticResource SecondaryTextColor}" />

            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                <Button
                    x:Name="btnAdd"
                    Margin="0,0,10,0"
                    Padding="8,0"
                    md:ButtonAssist.CornerRadius="4"
                    md:ElevationAssist.Elevation="Dp24"
                    Background="{StaticResource SuccessButtonBackground}"
                    BorderBrush="{StaticResource SuccessButtonBorder}"
                    Click="BtnAddSale_Click"
                    Content="➕ Yangi savdo"
                    Foreground="{StaticResource SuccessButtonForeground}" />

                <Button
                    x:Name="btnBack"
                    Padding="8,0"
                    md:ButtonAssist.CornerRadius="4"
                    md:ElevationAssist.Elevation="Dp24"
                    Background="{DynamicResource BackButtonBackground}"
                    BorderBrush="{StaticResource BackButtonBorder}"
                    Click="BtnBack_Click"
                    Content="🔙 Orqaga"
                    Foreground="{StaticResource BackButtonForeground}" />
            </StackPanel>
        </DockPanel>

        <!--  Filters  -->
        <Grid Grid.Row="1" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <TextBlock
                VerticalAlignment="Center"
                FontSize="16"
                Text="Davr oralig'i:" />

            <controls:UserCalendar
                Grid.Column="2"
                Width="110"
                Height="28"
                HorizontalAlignment="Left"
                FontSize="14"
                SelectedDate="{Binding BeginDate, Mode=TwoWay}" />

            <TextBlock
                Grid.Column="4"
                VerticalAlignment="Center"
                FontSize="16"
                Text="dan" />

            <controls:UserCalendar
                Grid.Column="6"
                Width="110"
                Height="28"
                HorizontalAlignment="Left"
                FontSize="14"
                SelectedDate="{Binding EndDate, Mode=TwoWay}" />

            <TextBlock
                Grid.Column="8"
                VerticalAlignment="Center"
                FontSize="16"
                Text="gacha" />

            <TextBlock
                Grid.Column="10"
                VerticalAlignment="Center"
                FontSize="16"
                Text="Mijoz:" />

            <Border
                Grid.Column="12"
                BorderBrush="{DynamicResource PrimaryTextColor}"
                BorderThickness="1"
                CornerRadius="4">
                <ComboBox
                    Padding="5,1"
                    BorderThickness="0"
                    DisplayMemberPath="Name"
                    FontSize="14"
                    IsEditable="True"
                    IsTextSearchEnabled="True"
                    ItemsSource="{Binding AvailableCustomers}"
                    SelectedItem="{Binding SelectedCustomer}">
                    <ComboBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel />
                        </ItemsPanelTemplate>
                    </ComboBox.ItemsPanel>
                </ComboBox>
            </Border>

            <Button
                x:Name="btnFilter"
                Grid.Column="14"
                Padding="8,0"
                HorizontalAlignment="Left"
                md:ButtonAssist.CornerRadius="4"
                md:ElevationAssist.Elevation="Dp2"
                Background="{DynamicResource BackButtonBackground}"
                BorderBrush="{StaticResource BackButtonBorder}"
                Command="{Binding FilterSalesCommand}"
                Content="🔍 Yangilash"
                Foreground="{StaticResource BackButtonForeground}" />
        </Grid>

        <!--  DataGrid  -->
        <Grid Grid.Row="2" Margin="0,15,0,5">
            <DataGrid
                x:Name="dataGrid"
                AlternatingRowBackground="#F9F9F9"
                AutoGenerateColumns="False"
                BorderThickness="2"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                VirtualizingStackPanel.VirtualizationMode="Standard"
                EnableRowVirtualization="True"
                FontSize="14"
                HeadersVisibility="Column"
                IsReadOnly="True"
                ItemsSource="{Binding Sales}"
                SelectedItem="{Binding SelectedSale}"
                SelectionMode="Single"
                SelectionUnit="FullRow">

                <DataGrid.Resources>
                    <Style x:Key="RightAlignedCellStyle" TargetType="TextBlock">
                        <Setter Property="TextAlignment" Value="Right" />
                        <Setter Property="Padding" Value="0,0,5,0" />
                    </Style>

                    <Style x:Key="CenterAlignedCellStyle" TargetType="TextBlock">
                        <Setter Property="TextAlignment" Value="Center" />
                    </Style>

                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="HorizontalContentAlignment" Value="Center" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                    </Style>
                </DataGrid.Resources>

                <DataGrid.Columns>
                    <DataGridTemplateColumn Width="60" Header="T/r">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock HorizontalAlignment="Center" 
                       VerticalAlignment="Center"
                       Text="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, 
                                      Converter={StaticResource IndexConverter}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn
                        Width="110"
                        Binding="{Binding Date, StringFormat={}{0:dd.MM.yyyy}}"
                        ElementStyle="{StaticResource CenterAlignedCellStyle}"
                        Header="Sana" />

                    <DataGridTextColumn
                        Width="2*"
                        MinWidth="150"
                        Binding="{Binding Customer.Name}"
                        Header="Mijoz" />

                    <DataGridTextColumn
                        Width="*"
                        MinWidth="100"
                        Binding="{Binding TotalCount, StringFormat={}{0:N0}}"
                        ElementStyle="{StaticResource RightAlignedCellStyle}"
                        Header="Jami dona" />

                    <DataGridTextColumn
                        Width="1.2*"
                        MinWidth="140"
                        Binding="{Binding TotalAmount, StringFormat={}{0:N2}}"
                        ElementStyle="{StaticResource RightAlignedCellStyle}"
                        Header="Summa" />

                    <DataGridTextColumn
                        Width="2*"
                        MinWidth="150"
                        Binding="{Binding Note}"
                        Header="Izoh" />

                    <DataGridTemplateColumn Width="90" Header="Amallar">
                        <DataGridTemplateColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="HorizontalContentAlignment" Value="Center" />
                                <Setter Property="FontWeight" Value="SemiBold" />
                            </Style>
                        </DataGridTemplateColumn.HeaderStyle>
                        <DataGridTemplateColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="Padding" Value="4" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="DataGridCell">
                                            <StackPanel
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Orientation="Horizontal">
                                                <!--  EDIT BUTTON  -->
                                                <Button
                                                    x:Name="btnEdit"
                                                    Width="30"
                                                    Height="26"
                                                    Margin="2,0"
                                                    Padding="0"
                                                    Background="#FFB300"
                                                    Click="BtnEditSale_Click"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Foreground="White"
                                                    Tag="{Binding}"
                                                    ToolTip="Tahrirlash">
                                                    <md:PackIcon
                                                        Width="16"
                                                        Height="16"
                                                        Kind="Pencil" />
                                                </Button>
                                                <!--  DELETE BUTTON  -->
                                                <Button
                                                    Width="30"
                                                    Height="26"
                                                    Margin="2,0"
                                                    Padding="0"
                                                    Background="#D32F2F"
                                                    Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Foreground="White"
                                                    ToolTip="O'chirish">
                                                    <md:PackIcon
                                                        Width="16"
                                                        Height="16"
                                                        Kind="Delete" />
                                                </Button>
                                            </StackPanel>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGridTemplateColumn.CellStyle>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Page>