<Page
    x:Class="Forex.Wpf.Pages.Users.UserPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Forex.Wpf.Resources.UserControls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="User oynasi"
    d:DesignHeight="580"
    d:DesignWidth="810"
    mc:Ignorable="d">


    <Page.Resources>
        <!--  Umumiy DataGridCell style  -->
        <Style x:Key="TransparentCellStyle" TargetType="DataGridCell">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
    </Page.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  🔎 Qidiruv  -->
        <Border
            Grid.Row="0"
            Width="240"
            Margin="0,5"
            Padding="0"
            HorizontalAlignment="Left"
            Background="{DynamicResource SelectedBackground}"
            BorderBrush="{DynamicResource SelectedBorderColor}"
            BorderThickness="1"
            CornerRadius="5">
            <TextBox
                x:Name="txtSearch"
                Width="230"
                Margin="5,1,2,1"
                Padding="0"
                md:HintAssist.Hint="Qidiruv.."
                BorderBrush="Gray"
                BorderThickness="0"
                FontSize="16" />
        </Border>

        <Button
            x:Name="btnBack"
            Grid.Row="0"
            HorizontalAlignment="Right"
            md:ButtonAssist.CornerRadius="5"
            Background="{DynamicResource OtherBackground}"
            BorderThickness="0"
            Content="🔙 Orqaga"
            ToolTip="Orqaga" />

        <!--  ➕ Qo‘shish formasi  -->
        <WrapPanel Grid.Row="1" Orientation="Horizontal">
            <Border
                Width="120"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4">
                <ComboBox
                    x:Name="cbRole"
                    Width="105"
                    Padding="5,1,2,1"
                    md:HintAssist.Hint="Tanlash"
                    BorderThickness="0"
                    FontSize="16"
                    IsEditable="False"
                    IsTextSearchEnabled="False"
                    StaysOpenOnEdit="True" />
            </Border>

            <Border
                Width="115"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4">
                <TextBox
                    x:Name="txtName"
                    Width="112"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Nomi"
                    BorderThickness="0"
                    FontSize="16" />
            </Border>

            <Border
                Width="145"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4">
                <TextBox
                    x:Name="txtPhone"
                    Width="143"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Telefon"
                    BorderThickness="0"
                    FontSize="16"
                    TextChanged="TxtPhone_TextChanged" />
            </Border>

            <Border
                Width="200"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4">
                <TextBox
                    x:Name="txtAddress"
                    Width="195"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Manzil"
                    BorderThickness="0"
                    FontSize="16" />
            </Border>

            <Border
                Width="200"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4">
                <TextBox
                    x:Name="txtDescription"
                    Width="195"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Izoh"
                    BorderThickness="0"
                    FontSize="16" />
            </Border>

            <Border
                x:Name="brValutaType"
                Width="120"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="Collapsed">
                <ComboBox
                    x:Name="cbxValutaType"
                    Width="105"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Valyuta turi"
                    BorderThickness="0"
                    FontSize="16"
                    IsEditable="False"
                    IsTextSearchEnabled="False"
                    StaysOpenOnEdit="True" />
            </Border>


            <Border
                x:Name="brDebt"
                Width="120"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="Collapsed">
                <TextBox
                    x:Name="tbDebt"
                    Width="115"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Qarzdorlik"
                    BorderThickness="0"
                    DataObject.Pasting="NumericTextBox_Pasting"
                    FontSize="16"
                    Foreground="Red"
                    PreviewTextInput="NumericTextBox_PreviewTextInput"
                    TextChanged="TbDebt_TextChanged" />
            </Border>

            <Border
                x:Name="brAccount"
                Width="120"
                Margin="1,0,1,2"
                Background="{DynamicResource SelectedBackground}"
                BorderBrush="{DynamicResource SelectedBorderColor}"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="Collapsed">
                <TextBox
                    x:Name="tbAccount"
                    Width="115"
                    Padding="3,1,2,1"
                    md:HintAssist.Hint="Haqdorlik"
                    BorderThickness="0"
                    DataObject.Pasting="NumericTextBox_Pasting"
                    FontSize="16"
                    Foreground="Green"
                    PreviewTextInput="NumericTextBox_PreviewTextInput"
                    TextChanged="TbAccount_TextChanged" />
            </Border>

            <StackPanel
                x:Name="pnlEmployeeAccess"
                Orientation="Horizontal"
                Visibility="Collapsed">
                <ToggleButton
                    x:Name="tglHasAccess"
                    Margin="5,0"
                    Content="🗝"
                    Style="{StaticResource MaterialDesignActionLightToggleButton}"
                    ToolTip="Tizimga kirish uchun login parol biriktirish" />

                <Border
                    x:Name="brLogin"
                    Width="130"
                    Margin="1,0,1,2"
                    Background="{DynamicResource SelectedBackground}"
                    BorderBrush="{DynamicResource SelectedBorderColor}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Visibility="{Binding IsChecked, ElementName=tglHasAccess, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBox
                        x:Name="txtUsername"
                        Width="125"
                        Padding="3,1,2,1"
                        md:HintAssist.Hint="Username"
                        BorderThickness="0"
                        FontSize="16" />
                </Border>

                <Border
                    x:Name="brPassword"
                    Width="130"
                    Margin="1,0,1,2"
                    Background="{DynamicResource SelectedBackground}"
                    BorderBrush="{DynamicResource SelectedBorderColor}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Visibility="{Binding IsChecked, ElementName=tglHasAccess, Converter={StaticResource BoolToVisibilityConverter}}">
                    <PasswordBox
                        x:Name="txtPassword"
                        Width="125"
                        Padding="3,1,2,1"
                        md:HintAssist.Hint="Parol"
                        BorderThickness="0"
                        FontSize="16" />
                </Border>
            </StackPanel>
            <Button
                x:Name="btnSave"
                MinWidth="50"
                Margin="3,0,0,3"
                Padding="3,1,2,1"
                md:ButtonAssist.CornerRadius="4"
                Background="{DynamicResource OtherBackground}"
                BorderThickness="0"
                Content="💾 Saqlash"
                FontWeight="Bold"
                Foreground="{DynamicResource PrimaryTextColor}"
                ToolTip="Saqlash"
                Visibility="Collapsed" />

            <Button
                x:Name="btnUpdate"
                MinWidth="50"
                Margin="3,0,0,3"
                Padding="3,1,2,1"
                md:ButtonAssist.CornerRadius="4"
                Background="{DynamicResource OtherBackground}"
                BorderThickness="0"
                Content="🔄 Yangilash"
                FontWeight="Bold"
                Foreground="{DynamicResource PrimaryTextColor}"
                ToolTip="Yangilash"
                Visibility="Collapsed" />
        </WrapPanel>

        <!--  📋 Jadval  -->
        <DataGrid
            x:Name="dgUsers"
            Grid.Row="2"
            Margin="0"
            VirtualizingStackPanel.VirtualizationMode="Standard"
            EnableRowVirtualization="True"
            AutoGenerateColumns="False"
            BorderBrush="Gray"
            BorderThickness="1"
            CanUserAddRows="False"
            HeadersVisibility="Column"
            IsReadOnly="True"
            ItemsSource="{Binding filteredUsers}">

            <DataGrid.Columns>

                <DataGridTemplateColumn Width="60" Header="T/r">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock HorizontalAlignment="Center" 
                       VerticalAlignment="Center"
                       Text="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, 
                                      Converter={StaticResource IndexConverter}}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Name}"
                    Header="Nomi">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Padding" Value="5,0" />
                            <Setter Property="HorizontalAlignment" Value="Left" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Phone}"
                    Header="Telefon">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Padding" Value="5,0" />
                            <Setter Property="HorizontalAlignment" Value="Left" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Address}"
                    Header="Manzil">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Padding" Value="5,0" />
                            <Setter Property="HorizontalAlignment" Value="Left" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Description}"
                    Header="Izoh">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Left" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="Padding" Value="5,0" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Role}"
                    Header="Rol">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding FirstBalance, StringFormat={}{0:N2}}"
                    Header="Hisob qoldiq">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Right" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                            <Setter Property="Padding" Value="0,0,15,0" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding FirstCurrencyName}"
                    Header="Valyuta turi">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTemplateColumn Width="90" Header="Amallar">
                    <DataGridTemplateColumn.CellStyle>
                        <Style BasedOn="{StaticResource {x:Type DataGridCell}}" TargetType="DataGridCell">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                            <Setter Property="Padding" Value="4" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <StackPanel
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Orientation="Horizontal">
                                            <Button
                                                x:Name="btnEdit"
                                                Width="30"
                                                Height="26"
                                                Margin="2,0"
                                                Padding="0"
                                                Background="#FFB300"
                                                Click="btnEdit_Click"
                                                FontSize="12"
                                                FontWeight="Bold"
                                                Foreground="White"
                                                Tag="{Binding}"
                                                ToolTip="Tahrirlash">
                                                <md:PackIcon
                                                    Width="16"
                                                    Height="16"
                                                    Kind="Pencil" />
                                            </Button>
                                            <Button
                                                x:Name="btnDelete"
                                                Width="30"
                                                Height="26"
                                                Margin="2,0"
                                                Padding="0"
                                                Background="#D32F2F"
                                                Click="btnDelete_Click"
                                                Cursor="Hand"
                                                FontSize="12"
                                                FontWeight="Bold"
                                                Foreground="White"
                                                Tag="{Binding}"
                                                ToolTip="O'chirish">
                                                <md:PackIcon
                                                    Width="16"
                                                    Height="16"
                                                    Kind="Delete" />
                                            </Button>
                                        </StackPanel>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTemplateColumn.CellStyle>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Page>
